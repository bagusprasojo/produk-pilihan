<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Etalase Produk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --bg: #f7f4ef;
        --bg-accent: #f1e9dd;
        --card: #ffffff;
        --ink: #1e1b16;
        --muted: #6b6259;
        --accent: #d25b3c;
        --accent-2: #1f7a6f;
        --ring: rgba(30, 27, 22, 0.12);
        --shadow: 0 18px 60px rgba(30, 27, 22, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Space Grotesk", "Segoe UI", sans-serif;
        color: var(--ink);
        background: radial-gradient(
            circle at 10% 0%,
            rgba(210, 91, 60, 0.18),
            transparent 45%
          ),
          radial-gradient(
            circle at 90% 10%,
            rgba(31, 122, 111, 0.2),
            transparent 40%
          ),
          linear-gradient(180deg, var(--bg) 0%, var(--bg-accent) 100%);
        min-height: 100vh;
      }

      .page {
        max-width: 1160px;
        margin: 0 auto;
        padding: 36px 20px 80px;
      }

      header {
        display: grid;
        gap: 16px;
        margin-bottom: 28px;
      }

      .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.18em;
        font-size: 12px;
        color: var(--muted);
      }

      h1 {
        margin: 0;
        font-family: "Fraunces", serif;
        font-size: clamp(2.2rem, 3vw, 3.5rem);
        line-height: 1.1;
      }

      .subhead {
        max-width: 720px;
        font-size: 1rem;
        color: var(--muted);
      }

      .stats {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      .stat-pill {
        padding: 8px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid var(--ring);
        font-size: 0.9rem;
      }

      .controls {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        padding: 16px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid var(--ring);
        border-radius: 18px;
        box-shadow: var(--shadow);
        margin-bottom: 22px;
      }

      .input,
      .select {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 14px;
        border-radius: 12px;
        background: #fff;
        border: 1px solid var(--ring);
        font-size: 0.95rem;
      }

      .input input,
      .select select {
        border: none;
        outline: none;
        flex: 1;
        font: inherit;
        background: transparent;
        color: var(--ink);
      }

      .grid {
        display: grid;
        gap: 18px;
        grid-template-columns: repeat(auto-fill, minmax(240px, 260px));
        justify-content: center;
      }

      .card {
        display: grid;
        grid-template-rows: 290px auto;
        background: var(--card);
        border-radius: 18px;
        overflow: hidden;
        box-shadow: var(--shadow);
        border: 1px solid rgba(255, 255, 255, 0.6);
        transform: translateY(0);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        animation: rise 0.5s ease both;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 24px 80px rgba(30, 27, 22, 0.18);
      }

      .card-media {
        position: relative;
        background: linear-gradient(135deg, #f8f4ee 0%, #ece4d7 100%);
        overflow: hidden;
        padding: 12px;
      }

      .card-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        filter: saturate(1.05);
        border-radius: 12px;
      }

      .badge-row {
        position: absolute;
        left: 14px;
        bottom: 14px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .badge {
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.72rem;
        background: rgba(30, 27, 22, 0.8);
        color: #fff;
      }

      .card-body {
        padding: 16px 16px 18px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .title {
        font-weight: 600;
        font-size: 1rem;
        margin: 0;
      }

      .meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: var(--muted);
      }

      .price {
        font-size: 1.05rem;
        font-weight: 700;
        color: var(--accent-2);
      }

      .desc {
        color: var(--muted);
        font-size: 0.9rem;
        line-height: 1.5;
        margin: 0;
        flex: 1;
      }

      .actions {
        display: flex;
        gap: 10px;
        margin-top: auto;
      }

      .btn {
        flex: 1;
        height: 40px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid transparent;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--accent);
        color: #fff;
      }

      .btn-ghost {
        border-color: var(--ring);
        color: var(--ink);
        background: #fff;
      }

      .btn-disabled {
        opacity: 0.6;
        pointer-events: none;
      }

      .icon {
        width: 16px;
        height: 16px;
        display: inline-flex;
      }

      .pagination {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 26px;
        flex-wrap: wrap;
      }

      .page-btn {
        min-width: 36px;
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid var(--ring);
        background: #fff;
        cursor: pointer;
        font-weight: 600;
      }

      .page-btn.active {
        background: var(--ink);
        color: #fff;
      }

      .empty {
        text-align: center;
        color: var(--muted);
        padding: 32px 0;
      }

      .overlay {
        position: fixed;
        inset: 0;
        background: rgba(30, 27, 22, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      .overlay.open {
        opacity: 1;
        pointer-events: auto;
      }

      .share-panel {
        width: min(420px, 100%);
        background: #fff;
        border-radius: 18px;
        padding: 18px;
        box-shadow: var(--shadow);
        display: grid;
        gap: 14px;
      }

      .share-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .share-title {
        font-weight: 700;
        margin: 0;
      }

      .share-actions {
        display: grid;
        gap: 10px;
      }

      .share-btn {
        width: 100%;
        height: 44px;
        border-radius: 12px;
        border: 1px solid var(--ring);
        background: #fff;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
        text-decoration: none;
        color: var(--ink);
      }

      .share-note {
        font-size: 0.85rem;
        color: var(--muted);
        margin: 0;
      }
      @keyframes rise {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 640px) {
        .controls {
          grid-template-columns: 1fr;
        }
        .card {
          grid-template-rows: 270px auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div class="eyebrow">Etalase</div>
        <h1>Produk pilihan hari ini.</h1>
        <p class="subhead">
          Jelajahi koleksi produk terbaru dengan tampilan modern dan responsif.
          Gunakan pencarian untuk mempercepat, lalu lanjutkan dengan pagination.
        </p>
        <div class="stats" id="stats"></div>
      </header>

      <section class="controls">
        <label class="input">
          <span>Search</span>
          <input
            id="searchInput"
            type="search"
            placeholder="Cari nama produk atau deskripsi"
          />
        </label>
        <label class="select">
          <span>Urutkan</span>
          <select id="sortSelect">
            <option value="newest">Terbaru</option>
            <option value="oldest">Terlama</option>
            <option value="title">Judul A-Z</option>
          </select>
        </label>
      </section>

      <section class="grid" id="grid"></section>
      <div class="pagination" id="pagination"></div>
      <div class="empty" id="emptyState" hidden>Tidak ada produk.</div>
    </div>

    <div class="overlay" id="shareOverlay" aria-hidden="true">
      <div class="share-panel" role="dialog" aria-modal="true">
        <div class="share-header">
          <h3 class="share-title">Bagikan produk</h3>
          <button class="share-btn" id="closeShare">Tutup</button>
        </div>
        <div class="share-actions">
          <a class="share-btn" id="shareWa" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 2a9.8 9.8 0 0 0-8.3 15.1L2 22l5-1.6A10 10 0 1 0 12 2Zm0 2a8 8 0 0 1 0 16c-1.4 0-2.7-.4-3.9-1l-.3-.2-2.9.9.9-2.8-.2-.3A8 8 0 0 1 12 4Zm4.2 9.7c-.2-.1-1.3-.6-1.5-.7-.2-.1-.4-.1-.5.1-.2.2-.6.7-.7.8-.1.1-.3.1-.5 0-.2-.1-.8-.3-1.6-1-.6-.6-1-1.3-1.1-1.5-.1-.2 0-.4.1-.5.1-.1.2-.3.3-.4.1-.1.1-.2.2-.3.1-.1 0-.2 0-.4 0-.1-.5-1.2-.7-1.7-.2-.5-.4-.4-.5-.4h-.4c-.1 0-.4.1-.6.3-.2.2-.8.8-.8 1.9s.8 2.2.9 2.3c.1.1 1.6 2.5 3.9 3.4 2.3.9 2.3.6 2.7.6.4-.1 1.3-.5 1.5-1 .2-.5.2-.9.2-1 0-.1-.2-.2-.4-.3Z"
                />
              </svg>
            </span>
            WhatsApp
          </a>
          <a class="share-btn" id="shareFb" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M13 10h3l.5-3H13V5.8c0-.9.3-1.3 1.2-1.3H16V2h-2.6C11 2 10 3.2 10 5.4V7H8v3h2v8h3v-8Z"
                />
              </svg>
            </span>
            Facebook
          </a>
          <a class="share-btn" id="shareX" target="_blank" rel="noreferrer">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18.2 2h3.1l-6.8 7.8L22 22h-6.2l-4.9-6.4L5.3 22H2.2l7.3-8.4L2 2h6.3l4.4 5.9L18.2 2Zm-1.1 18h1.7L7.9 4H6.1l11 16Z"
                />
              </svg>
            </span>
            X (Twitter)
          </a>
          <button class="share-btn" id="shareCopy">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M16 1H6a2 2 0 0 0-2 2v10h2V3h10V1Zm2 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H10V7h8v14Z"
                />
              </svg>
            </span>
            Copy URL
          </button>
        </div>
        <p class="share-note" id="sharePreview"></p>
      </div>
    </div>

    <script>
      const state = {
        products: [],
        filtered: [],
        page: 1,
        pageSize: 6,
        query: "",
        sort: "newest",
      };

      const grid = document.getElementById("grid");
      const pagination = document.getElementById("pagination");
      const emptyState = document.getElementById("emptyState");
      const searchInput = document.getElementById("searchInput");
      const sortSelect = document.getElementById("sortSelect");
      const stats = document.getElementById("stats");
      const shareOverlay = document.getElementById("shareOverlay");
      const closeShare = document.getElementById("closeShare");
      const shareWa = document.getElementById("shareWa");
      const shareFb = document.getElementById("shareFb");
      const shareX = document.getElementById("shareX");
      const shareCopy = document.getElementById("shareCopy");
      const sharePreview = document.getElementById("sharePreview");
      let activeShare = null;

      const slugify = (value) =>
        value
          .toLowerCase()
          .replace(/[^a-z0-9\s-]/g, "")
          .replace(/\s+/g, "-")
          .replace(/-+/g, "-")
          .replace(/^-|-$/g, "");

      const formatDate = (value) => {
        if (!value) return "-";
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return value;
        return date.toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      };

      const formatPrice = (value) => {
        if (value === undefined || value === null || value === "") return "-";
        if (typeof value === "number") {
          return `Rp${new Intl.NumberFormat("id-ID").format(value)}`;
        }
        const asString = String(value).trim();
        if (/[^\d\s.,]/.test(asString)) return asString;
        const cleaned = asString.replace(/[^\d]/g, "");
        if (!cleaned) return asString;
        return `Rp${new Intl.NumberFormat("id-ID").format(Number(cleaned))}`;
      };

      const escapeAttr = (value) =>
        String(value ?? "")
          .replace(/&/g, "&amp;")
          .replace(/"/g, "&quot;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");

      const applyFilters = () => {
        const query = state.query.trim().toLowerCase();
        let items = [...state.products];
        if (query) {
          items = items.filter(
            (item) =>
              item.title.toLowerCase().includes(query) ||
              item.description.toLowerCase().includes(query)
          );
        }
        if (state.sort === "title") {
          items.sort((a, b) => a.title.localeCompare(b.title));
        } else if (state.sort === "oldest") {
          items.sort(
            (a, b) => new Date(a.tanggal || 0) - new Date(b.tanggal || 0)
          );
        } else {
          items.sort(
            (a, b) => new Date(b.tanggal || 0) - new Date(a.tanggal || 0)
          );
        }
        state.filtered = items;
        state.page = 1;
        render();
      };

      const renderStats = () => {
        const total = state.products.length;
        const latest = state.products[0]?.tanggal;
        stats.innerHTML = `
          <div class="stat-pill">${total} Produk</div>
          <div class="stat-pill">Update: ${formatDate(latest)}</div>
          <div class="stat-pill">Mode: Dinamis</div>
        `;
      };

      const renderGrid = () => {
        const start = (state.page - 1) * state.pageSize;
        const end = start + state.pageSize;
        const slice = state.filtered.slice(start, end);

        grid.innerHTML = "";
        if (!slice.length) {
          emptyState.hidden = false;
          return;
        }
        emptyState.hidden = true;

        const fragment = document.createDocumentFragment();
        slice.forEach((product, index) => {
          const card = document.createElement("article");
          card.className = "card";
          card.style.animationDelay = `${index * 0.06}s`;
          const slug = slugify(product.title);
          const badges = [product.status1, product.status2, product.review]
            .filter(Boolean)
            .map((text) => `<span class="badge">${text}</span>`)
            .join("");
          const statusText = [product.status1, product.status2]
            .filter(Boolean)
            .join(" / ");
          const priceText = formatPrice(product.harga);
          const productUrl = `p/${slug}.html`;
          const affiliateUrl = product.affiliate_url || "";
          const buyDisabled = !affiliateUrl;
          card.innerHTML = `
            <div class="card-media">
              <img src="${product.image}" alt="${product.title}" loading="lazy" />
              <div class="badge-row">${badges}</div>
            </div>
            <div class="card-body">
              <h2 class="title">${product.title}</h2>
              <div class="price">${priceText}</div>
              <div class="meta">
                <span>${formatDate(product.tanggal)}</span>
                <span>${product.review || " "}</span>
              </div>
              <p class="desc">${product.description}</p>
              <div class="actions">
                <a
                  class="btn btn-ghost${buyDisabled ? " btn-disabled" : ""}"
                  href="${affiliateUrl || "#"}"
                  target="_blank"
                  rel="noreferrer"
                >
                  <span class="icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path
                        d="M7 4h10l2 4v10a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8l2-4Zm0 4v10h10V8H7Zm2-2h6l-.7-2H9.7L9 6Z"
                      />
                    </svg>
                  </span>
                  Beli
                </a>
                <a
                  class="btn btn-primary share-trigger"
                  href="#"
                  data-title="${escapeAttr(product.title)}"
                  data-status="${escapeAttr(statusText)}"
                  data-review="${escapeAttr(product.review || "")}"
                  data-harga="${escapeAttr(priceText)}"
                  data-description="${escapeAttr(product.description)}"
                  data-url="${escapeAttr(productUrl)}"
                >
                  <span class="icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path
                        d="M18 16a3 3 0 0 0-2.4 1.2l-7.1-3.6a3 3 0 0 0 0-2.2l7.1-3.6A3 3 0 1 0 15 5a3 3 0 0 0 .1.7L8 9.3a3 3 0 1 0 0 5.4l7.1 3.6A3 3 0 1 0 18 16Z"
                      />
                    </svg>
                  </span>
                  Share
                </a>
              </div>
            </div>
          `;
          fragment.appendChild(card);
        });
        grid.appendChild(fragment);
      };

      const renderPagination = () => {
        const totalPages = Math.ceil(state.filtered.length / state.pageSize);
        pagination.innerHTML = "";
        if (totalPages <= 1) return;

        const createButton = (label, page, isActive = false) => {
          const button = document.createElement("button");
          button.className = `page-btn${isActive ? " active" : ""}`;
          button.textContent = label;
          button.addEventListener("click", () => {
            state.page = page;
            render();
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
          return button;
        };

        pagination.appendChild(
          createButton("Prev", Math.max(1, state.page - 1))
        );

        const maxButtons = 5;
        let start = Math.max(1, state.page - 2);
        let end = Math.min(totalPages, start + maxButtons - 1);
        if (end - start < maxButtons - 1) {
          start = Math.max(1, end - maxButtons + 1);
        }

        for (let i = start; i <= end; i += 1) {
          pagination.appendChild(createButton(i, i, i === state.page));
        }

        pagination.appendChild(
          createButton("Next", Math.min(totalPages, state.page + 1))
        );
      };

      const render = () => {
        renderGrid();
        renderPagination();
      };

      const openShare = (data) => {
        activeShare = data;
        const shareTextParts = [
          data.title,
          data.status ? `Status: ${data.status}` : "",
          data.review ? `Review: ${data.review}` : "",
          data.harga ? `Harga: ${data.harga}` : "",
          data.description,
        ].filter(Boolean);
        const shareText = shareTextParts.join(" | ");
        const shareUrl = new URL(data.url, window.location.href).toString();
        const encodedText = encodeURIComponent(shareText);
        const encodedUrl = encodeURIComponent(shareUrl);

        shareWa.href = `https://wa.me/?text=${encodedText}%0A${encodedUrl}`;
        shareX.href = `https://twitter.com/intent/tweet?text=${encodedText}&url=${encodedUrl}`;
        shareFb.href = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}`;
        sharePreview.textContent = `${shareText} - ${shareUrl}`;

        shareOverlay.classList.add("open");
        shareOverlay.setAttribute("aria-hidden", "false");
      };

      const closeSharePanel = () => {
        shareOverlay.classList.remove("open");
        shareOverlay.setAttribute("aria-hidden", "true");
        activeShare = null;
      };

      searchInput.addEventListener("input", (event) => {
        state.query = event.target.value;
        applyFilters();
      });

      sortSelect.addEventListener("change", (event) => {
        state.sort = event.target.value;
        applyFilters();
      });

      document.addEventListener("click", (event) => {
        const trigger = event.target.closest(".share-trigger");
        if (trigger) {
          event.preventDefault();
          openShare({
            title: trigger.dataset.title,
            status: trigger.dataset.status,
            review: trigger.dataset.review,
            harga: trigger.dataset.harga,
            description: trigger.dataset.description,
            url: trigger.dataset.url,
          });
          return;
        }

        if (event.target === shareOverlay) {
          closeSharePanel();
        }
      });

      closeShare.addEventListener("click", () => {
        closeSharePanel();
      });

      shareCopy.addEventListener("click", async () => {
        if (!activeShare) return;
        const shareUrl = new URL(activeShare.url, window.location.href).toString();
        try {
          await navigator.clipboard.writeText(shareUrl);
          shareCopy.textContent = "Tersalin!";
          setTimeout(() => {
            shareCopy.textContent = "Copy URL";
          }, 1200);
        } catch {
          shareCopy.textContent = "Gagal";
        }
      });

      fetch("products.json")
        .then((response) => response.json())
        .then((data) => {
          state.products = data;
          renderStats();
          applyFilters();
        })
        .catch(() => {
          emptyState.hidden = false;
          emptyState.textContent = "Gagal memuat data produk.";
        });
    </script>
  </body>
</html>
